<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Permainan Kosa Kata BM‚ÄìCN‚ÄìEN</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{ --brand:#ff9800; --brandDark:#f57c00; --ok:#4caf50; --bad:#e91e63; --ink:#333; }
  *{ box-sizing:border-box }
  body{ font-family:'Comic Neue','Comic Sans MS',cursive,sans-serif; background:linear-gradient(to bottom,#ffecd2,#fcb69f); margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; text-align:center;}
  h1{ color:#ff5722; margin:16px 0 8px; }
  #game-box{ background:#fff; padding:20px; border-radius:16px; box-shadow:0 6px 14px rgba(0,0,0,.15); width:min(720px,92%); margin:10px 0 18px; }
  .word{ font-size:clamp(22px,4.8vw,34px); font-weight:800; color:#333; margin:12px 0 14px; }
  .music-controls{ margin:8px 0 0; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .mc-label{ font-weight:700; padding:6px 10px; border-radius:10px; background:#f3e9ff; color:#5e2a9a; }
  .mc-btn{ border:none; padding:8px 14px; border-radius:10px; cursor:pointer; font-weight:700; color:#fff; background:#2ecc71; }
  .mc-btn.pause{ background:#e74c3c; }
  .volume-wrap{ display:flex; align-items:center; gap:8px; justify-content:center; margin:6px 0 8px; }
  #bgm-vol{ width:min(260px,60vw); } #bgm-vol-val{ font-weight:700; color:#5e2a9a; }
  #answer-mode{ display:inline-flex; align-items:center; gap:8px; margin:8px 0 14px; } #ans-mode{ border:1px solid #ddd; border-radius:8px; padding:4px 8px; font-weight:700; }
  #options{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; align-items:stretch; justify-items:stretch; }
  @media (max-width:480px){ #options{ grid-template-columns:1fr; } }
  .option{ display:flex; align-items:center; justify-content:flex-start; gap:10px; width:100%; padding:12px 14px; border-radius:12px; line-height:1.25; white-space:normal; background:#ff9800; color:#fff; border:none; cursor:pointer; transition:transform .15s ease, filter .15s ease; font-size:1.05em; font-weight:700; text-align:left; }
  .option:hover{ filter:brightness(.95); transform:translateY(-1px) } .option.correct{ background:#4caf50!important } .option.wrong{ background:#e91e63!important }
  .opt-badge{ display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; min-width:28px; border-radius:999px; background:rgba(255,255,255,.25); font-weight:800; }
  .opt-text{ text-align:left }
  #score,#timer,#progress{ font-size:1.05em; margin:6px 0 }
  #message{ position:fixed; inset:0; display:grid; place-items:center; pointer-events:none; z-index:1000 }
  .msg{ display:inline-flex; align-items:center; gap:.6rem; padding:.6rem 1.2rem; border-radius:20px; font-size:clamp(20px,4.6vw,38px); font-weight:900; color:#fff; text-shadow:2px 2px 4px rgba(0,0,0,.3); transform:scale(.3); opacity:0 }
  .msg.success{ background:linear-gradient(135deg,#00c853,#64dd17); border:3px solid #aeea00 } .msg.error{ background:linear-gradient(135deg,#ff5252,#e91e63); border:3px solid #ff8a80 }
  .msg.show{ animation:popKids 500ms cubic-bezier(.25,.9,.35,1) forwards }
  @keyframes popKids{ 0%{transform:scale(.3);opacity:0}30%{transform:scale(1.2);opacity:1}70%{transform:scale(1);opacity:1}100%{transform:scale(.95);opacity:0} }
  #end-screen{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:900; visibility:hidden }
  #end-card{ background:#fff; padding:22px 26px; border-radius:15px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,.3); max-width:360px }
  #end-card h2{ color:#ff5722; margin:0 0 12px } #end-card button{ background:#ff9800; border:none; color:#fff; padding:10px 20px; border-radius:10px; font-size:1em; cursor:pointer; margin-top:12px }
  #end-card button:hover{ background:#f57c00 }
  .editor-bar{display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}
  .ed-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1200}
  .ed-modal.show{display:flex}
  .ed-card{background:#fff;width:min(820px,95vw);max-height:86vh;overflow:auto;border-radius:14px;box-shadow:0 10px 26px rgba(0,0,0,.25)}
  .ed-head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #eee}
  .ed-title{font-weight:800;color:#333} .ed-body{padding:12px 16px} .ed-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;padding:12px 16px;border-top:1px solid #eee}
  .ed-table{width:100%;border-collapse:collapse} .ed-table th,.ed-table td{border:1px solid #eee;padding:8px} .ed-table input{width:100%;padding:6px 8px;border:1px solid #ddd;border-radius:8px}
  .btn{border:none;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer} .btn.primary{background:#ff9800;color:#fff} .btn.ghost{background:#f2f2f2} .btn.warn{background:#e74c3c;color:#fff}
</style>
</head>
<body>
  <h1>üéØ Permainan Kosa Kata</h1>
  <div class="music-controls"><span class="mc-label">Kawalan Muzik</span><button id="toggle-bgm" class="mc-btn">‚ñ∂Ô∏è Mula Muzik</button></div>
  <div class="volume-wrap"><label for="bgm-vol">Laras Volum:</label><input type="range" id="bgm-vol" min="0" max="100" value="60" /><span id="bgm-vol-val">60%</span></div>
  <div id="answer-mode"><label for="ans-mode">Pilihan Jawapan:</label><select id="ans-mode"><option value="mix">Campur (‰∏≠ + EN)</option><option value="en">Inggeris sahaja (EN)</option><option value="cn">Cina sahaja (‰∏≠)</option></select></div>
  <div id="editor-bar" class="editor-bar" style="display:none; margin:6px 0 10px"><button id="ed-open" class="btn primary" title="Buka Editor">‚úèÔ∏è Editor Kosa Kata</button><input id="ed-import" type="file" accept="application/json" style="display:none" /><button id="ed-import-btn" class="btn">üì• Import JSON</button><button id="ed-save-local" class="btn">üíæ Simpan (Local)</button><button id="ed-dl-json" class="btn">‚¨áÔ∏è words.json</button><button id="ed-dl-html" class="btn">‚¨áÔ∏è index.html</button></div>
  <audio id="bgm-audio" src="SakuraGirlDaisychosic.com.mp3" preload="auto" loop style="display:none"></audio>
  <div id="game-box"><div id="timer">‚è≥ Masa: 0:00</div><div id="score">Markah: 0</div><div id="progress">Soalan: 0/21</div><div class="word" id="word">...</div><div id="options"></div></div>
  <div id="message" aria-live="polite" role="status"></div><canvas id="fx"></canvas>
  <div id="end-screen"><div id="end-card"><h2>Permainan Tamat!</h2><p id="final-score"></p><p id="final-time"></p><button id="restart">Ulang Semula</button></div></div>

<div id="editor-modal" class="ed-modal" aria-hidden="true"><div class="ed-card" role="dialog" aria-modal="true" aria-labelledby="ed-title"><div class="ed-head"><div id="ed-title" class="ed-title">Editor Kosa Kata</div><button id="ed-close" class="btn ghost">Tutup</button></div><div class="ed-body"><table class="ed-table"><thead><tr><th>BM</th><th>‰∏≠ (CN)</th><th>EN</th><th>Padam</th></tr></thead><tbody id="ed-tbody"></tbody></table></div><div class="ed-actions"><button id="ed-add" class="btn">+ Tambah Baris</button><span style="flex:1"></span><button id="ed-apply" class="btn primary">Guna dalam Permainan</button></div></div></div>

<script>
const vocab = [
  { bm: "Pemergian", cn: "Á¶ªÂéª", en: "Departure" },
  { bm: "Menyentuh", cn: "ËΩªËß¶", en: "Touch" },
  { bm: "Penduduk", cn: "Â±ÖÊ∞ë", en: "Resident" },
  { bm: "Perasaan", cn: "ÊÑüÂèó", en: "Feeling" },
  { bm: "Saudara-mara", cn: "‰∫≤Êàö", en: "Relatives" },
  { bm: "Kenal", cn: "ËÆ§ËØÜ", en: "Know" },
  { bm: "Segan", cn: "Áæû", en: "Shy" },
  { bm: "Kebahagiaan", cn: "Âπ∏Á¶è", en: "Happiness" },
  { bm: "Kesihatan", cn: "ÂÅ•Â∫∑", en: "Health" },
  { bm: "Pelajaran", cn: "Â≠¶‰π†", en: "Study" },
  { bm: "Pekerjaan", cn: "Â∑•‰Ωú", en: "Job" },
  { bm: "Kecantikan", cn: "Áæé‰∏Ω", en: "Beauty" },
  { bm: "Kekuatan", cn: "ÂäõÈáè", en: "Strength" },
  { bm: "Kelemahan", cn: "Âº±ÁÇπ", en: "Weakness" },
  { bm: "Kemerdekaan", cn: "Áã¨Á´ã", en: "Independence" },
  { bm: "Pertolongan", cn: "Â∏ÆÂä©", en: "Help" },
  { bm: "Perjumpaan", cn: "ËÅö‰ºö", en: "Meeting" },
  { bm: "Pertandingan", cn: "ÊØîËµõ", en: "Competition" },
  { bm: "Perkongsian", cn: "ÂàÜ‰∫´", en: "Sharing" },
  { bm: "Persahabatan", cn: "ÂèãË∞ä", en: "Friendship" },
  { bm: "Penerokaan", cn: "Êé¢Á¥¢", en: "Exploration" }
];
window.defaultVocab = vocab.slice();
window.vocab = (function(){ try{ const s = localStorage.getItem('vocabCustom'); return s? JSON.parse(s): vocab.slice(); }catch(e){ return vocab.slice(); } })();
let score = 0, answeredCount = 0, questions = [], currentQ = null;
function getTotalQuestions(){ return (window.vocab||[]).length; }
let timer = null, startTime = 0, elapsed = 0; let animTimeout;
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
function startTimer(){ startTime = Date.now(); if (timer) clearInterval(timer); timer = setInterval(()=>{ elapsed = Math.floor((Date.now()-startTime)/1000); const m=Math.floor(elapsed/60), s=elapsed%60; document.getElementById('timer').innerText = `‚è≥ Masa: ${m}:${s.toString().padStart(2,'0')}`; },1000); }
function showMessage({text, type='success', after}){ const holder=document.getElementById('message'); clearTimeout(animTimeout); holder.innerHTML = `<div class="msg ${type}">${text}</div>`; const badge=holder.firstElementChild; requestAnimationFrame(()=> badge.classList.add('show')); animTimeout=setTimeout(()=>{ badge.classList.remove('show'); if(typeof after==='function') after(); },700); }
function launchConfetti(){ const end=Date.now()+800;(function frame(){ confetti({ particleCount:7, angle:60, spread:60, startVelocity:45, gravity:.9, origin:{x:0} }); confetti({ particleCount:7, angle:120, spread:60, startVelocity:45, gravity:.9, origin:{x:1} }); if(Date.now()<end) requestAnimationFrame(frame); })(); }
function buildOptionsFor(q){ const mode=localStorage.getItem('ansLangMode')||'mix'; let correctLang=(mode==='en')?'en':(mode==='cn')?'cn':(Math.random()<0.5?'cn':'en'); let otherLang=(correctLang==='cn')?'en':'cn'; let correctAns=q[correctLang]; let bannedTwin=q[otherLang]; if(!correctAns){ correctLang=otherLang; otherLang=(correctLang==='cn')?'en':'cn'; correctAns=q[correctLang]; bannedTwin=q[otherLang]; } const norm=s=>(s||'').trim().toLowerCase(); const banCN=norm(q.cn), banEN=norm(q.en), banTwin=norm(bannedTwin); const seen=new Set([norm(correctAns)]), opts=[correctAns]; while(opts.length<4){ const list=(window.vocab||vocab); if(!list.length) break; const rnd=list[Math.floor(Math.random()*list.length)]; const pickLang=(mode==='mix')?(Math.random()<0.5?'cn':'en'):mode; const pick=pickLang==='cn'?rnd.cn:rnd.en; const n=norm(pick); if(!n||n===norm(correctAns)||n===banTwin||n===banCN||n===banEN||seen.has(n)) continue; seen.add(n); opts.push(pick); } opts.sort(()=>Math.random()-0.5); return {correctAns,opts}; }
function renderOptions(correctAns, opts){ const box=document.getElementById('options'); box.innerHTML=''; const letters=['A','B','C','D']; (opts||[]).slice(0,4).forEach((opt,i)=>{ const btn=document.createElement('button'); btn.type='button'; btn.className='option'; btn.dataset.value=opt; btn.innerHTML=`<span class="opt-badge">${letters[i]||''}</span><span class="opt-text">${opt}</span>`; btn.onclick=()=>checkAnswer(btn.dataset.value, correctAns, btn); box.appendChild(btn); }); }
function rebuildOptionsForCurrent(){ if(!window.currentQ) return; const b=buildOptionsFor(window.currentQ); renderOptions(b.correctAns,b.opts); }
function checkAnswer(choice, correct, btn){ if(choice===correct){ btn.classList.add('correct'); showMessage({text:'Tahniah! üèÜ',type:'success'}); setTimeout(()=>launchConfetti(),80); score++; answeredCount++; document.getElementById('score').innerText='Markah: '+score; const isLast=answeredCount>=getTotalQuestions(); setTimeout(()=>{ isLast? endGame(): nextQuestion(); }, isLast?700:500); } else { btn.classList.add('wrong'); if(score>0) score--; document.getElementById('score').innerText='Markah: '+score; showMessage({text:'Cuba lagi! ‚úñÔ∏è',type:'error'}); } }
function startGame(){ document.getElementById('end-screen').style.visibility='hidden'; score=0; answeredCount=0; elapsed=0; document.getElementById('score').innerText='Markah: 0'; document.getElementById('progress').innerText=`Soalan: 0/${getTotalQuestions()}`; questions=(window.vocab||vocab).slice(); shuffle(questions); startTimer(); nextQuestion(); }
function nextQuestion(){ if((questions||[]).length===0){ endGame(); return; } currentQ=questions.shift(); window.currentQ=currentQ; document.getElementById('word').innerText=currentQ.bm; document.getElementById('progress').innerText=`Soalan: ${answeredCount+1}/${getTotalQuestions()}`; const built=buildOptionsFor(currentQ); renderOptions(built.correctAns,built.opts); }
function endGame(){ clearInterval(timer); document.getElementById('final-score').innerText=`Markah akhir: ${score}/${getTotalQuestions()}`; document.getElementById('final-time').innerText=`Masa diambil: ${Math.floor(elapsed/60)} minit ${elapsed%60} saat`; document.getElementById('end-screen').style.visibility='visible'; }
document.getElementById('restart').addEventListener('click', startGame);
</script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>(function(){const audio=document.getElementById('bgm-audio');const btn=document.getElementById('toggle-bgm');const volEl=document.getElementById('bgm-vol');const volTxt=document.getElementById('bgm-vol-val');if(!audio||!btn)return;let storedVol=Number(localStorage.getItem('bgmVolume'));if(!(storedVol>=0&&storedVol<=1))storedVol=0.6;audio.volume=storedVol;if(volEl){volEl.value=Math.round(storedVol*100);if(volTxt)volTxt.textContent=volEl.value+'%';}let state='paused';let desired=localStorage.getItem('bgmDesired')||localStorage.getItem('bgmState')||'paused';const setDesired=v=>{desired=v;localStorage.setItem('bgmDesired',v);};const setState=v=>{state=v;localStorage.setItem('bgmState',v);ui();};function ui(){if(state==='playing'){btn.textContent='‚è∏Ô∏è Jeda Muzik';btn.classList.add('pause');}else{btn.textContent='‚ñ∂Ô∏è Mula Muzik';btn.classList.remove('pause');}}async function start(){setDesired('playing');try{if(audio.readyState<2)audio.load();btn.disabled=true;await audio.play();}catch(e){armUnlock();}finally{btn.disabled=false;}}function stop(){setDesired('paused');audio.pause();}function armUnlock(){if(window.__bgmUnlockArmed)return;window.__bgmUnlockArmed=true;const unlock=()=>{window.__bgmUnlockArmed=false;start();window.removeEventListener('pointerdown',unlock);document.removeEventListener('keydown',unlock);};window.addEventListener('pointerdown',unlock,{once:true});document.addEventListener('keydown',unlock,{once:true});}btn.addEventListener('click',()=>{if(state==='playing')stop();else start();});if(volEl){volEl.addEventListener('input',()=>{const v=Math.min(100,Math.max(0,Number(volEl.value)))/100;audio.volume=v;localStorage.setItem('bgmVolume',String(v));if(volTxt)volTxt.textContent=Math.round(v*100)+'%';});}audio.addEventListener('playing',()=>{if(desired!=='playing'){audio.pause();return;}setState('playing');});audio.addEventListener('pause',()=>{setState('paused');});ui();if(desired==='playing')start();})();</script>
<script>(function(){const sel=document.getElementById('ans-mode'); if(!sel)return; const saved=localStorage.getItem('ansLangMode')||'mix'; sel.value=saved; sel.addEventListener('change',()=>{localStorage.setItem('ansLangMode',sel.value); if(typeof rebuildOptionsForCurrent==='function') rebuildOptionsForCurrent();});})();</script>
<script>(function(){const url='words.json?cb='+Date.now(); fetch(url,{cache:'no-store'}).then(r=>r.ok?r.json():Promise.reject('no-json')).then(data=>{ if(Array.isArray(data)&&data.length){ window.vocab=data.slice(); window.defaultVocab=data.slice(); startGame(); }}).catch(()=>{});})();</script>
<script>(function(){const bar=document.getElementById('editor-bar'); const modal=document.getElementById('editor-modal'); const tbody=document.getElementById('ed-tbody'); const btnOpen=document.getElementById('ed-open'); const btnClose=document.getElementById('ed-close'); const btnAdd=document.getElementById('ed-add'); const btnApply=document.getElementById('ed-apply'); const impBtn=document.getElementById('ed-import-btn'); const impFile=document.getElementById('ed-import'); const btnSaveLocal=document.getElementById('ed-save-local'); const btnDlJson=document.getElementById('ed-dl-json'); const btnDlHtml=document.getElementById('ed-dl-html'); function isEditMode(){try{ if(location.hash==='#edit'||location.hash==='#admin')return true; if(/([?&])edit(=1|=true)?/i.test(location.search))return true; if(/\/edit$/i.test(location.pathname))return true;}catch(e){} return false;} function toggleBar(){ bar.style.display=isEditMode()?'flex':'none'; } window.addEventListener('hashchange',toggleBar); window.addEventListener('popstate',toggleBar); toggleBar(); function addRow(row){row=row||{bm:'',cn:'',en:''}; const tr=document.createElement('tr'); tr.innerHTML='<td><input value="'+(row.bm||'')+'"></td>'+'<td><input value="'+(row.cn||'')+'"></td>'+'<td><input value="'+(row.en||'')+'"></td>'+'<td style="text-align:center"><button class="btn warn ed-del">Padam</button></td>'; tr.querySelector('.ed-del').addEventListener('click',()=>tr.remove()); tbody.appendChild(tr);} function renderTable(list){tbody.innerHTML=''; (list||[]).forEach(addRow); if(!list||!list.length) addRow();} function collect(){const rows=[]; Array.from(tbody.querySelectorAll('tr')).forEach(tr=>{ const ins=tr.querySelectorAll('input'); const bm=(ins[0]&&ins[0].value||'').trim(); const cn=(ins[1]&&ins[1].value||'').trim(); const en=(ins[2]&&ins[2].value||'').trim(); if(bm||cn||en) rows.push({bm,cn,en}); }); return rows;} function applyToGame(list){ window.vocab=(list||[]).slice(); window.defaultVocab=(list||[]).slice(); if(typeof startGame==='function') startGame(); } if(btnOpen) btnOpen.addEventListener('click',()=>{ renderTable(window.vocab||[]); modal.classList.add('show'); modal.setAttribute('aria-hidden','false');}); if(btnClose) btnClose.addEventListener('click',()=>{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');}); if(btnAdd) btnAdd.addEventListener('click',()=> addRow()); if(btnApply) btnApply.addEventListener('click',()=>{ const data=collect(); applyToGame(data); alert('Digunakan dalam permainan.');}); if(impBtn) impBtn.addEventListener('click',()=> impFile&&impFile.click()); if(impFile) impFile.addEventListener('change',async (e)=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; try{ const txt=await f.text(); const data=JSON.parse(txt); renderTable(Array.isArray(data)?data:[]); modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }catch{ alert('Fail JSON tidak sah'); } }); if(btnSaveLocal) btnSaveLocal.addEventListener('click',()=>{ const data=modal.classList.contains('show')?collect():(window.vocab||[]); try{ localStorage.setItem('vocabCustom',JSON.stringify(data)); applyToGame(data); alert('Disimpan di peranti (localStorage).'); }catch{ alert('Gagal menyimpan.'); } }); if(btnDlJson) btnDlJson.addEventListener('click',()=>{ const data=modal.classList.contains('show')?collect():(window.vocab||[]); const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='words.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),500); }); if(btnDlHtml) btnDlHtml.addEventListener('click',()=>{ const data=modal.classList.contains('show')?collect():(window.vocab||[]); const html=document.documentElement.outerHTML; const baked=html.replace(/const\s+vocab\s*=\s*\[[\s\S]*?\];/,'const vocab = '+JSON.stringify(data,null,2)+';'); const blob=new Blob([baked],{type:'text/html;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='index.html'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),500); });})();</script>
<script>startGame();</script>
</body></html>
